{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col">
        <table class="table table-reg table-reg-display table-responsive">
            <colgroup>
                <col span="1" style="background-color: #D6EEEE">
            </colgroup>
        <tbody>
            <tr> 
                <th style="background-color: #D6EEEE">Name: </th>
                <td>{{ reg['fname'] }} {{ reg['lname'] }}</td>
            </tr>
            <tr>
                <th style="background-color: #D6EEEE">SCA Name: </th>
                <td>{{ reg['scaname'] }}</td>
            </tr>
            <tr>
                <th style="background-color: #D6EEEE">Registration ID: </th>
                <td>{{ reg['id'] }}</td>
            </tr>
            <tr>
                <th style="background-color: #D6EEEE">Invoice Number: </th>
                <td>{{ reg['invoice_number'] }}</td>
            </tr>
            <tr>
                <th style="background-color: #D6EEEE">Age Range: </th>
                <td>{{ reg['age'] }}</td>
            </tr>
            <tr>
                <th style="background-color: #D6EEEE">Membership: </th>
                <td>{{ reg['mbr'] }}</td>
            </tr>
            <tr>
                <th style="background-color: #D6EEEE">Kingdom: </th>
                <td>{{ reg['kingdom'] }}</td>
            </tr>
            <tr>
                <th style="background-color: #D6EEEE">Camp Group: </th>
                <td>{{ reg['lodging'] }}</td>
            </tr>
        </tbody>
        </table>
    </div>
    <div class="col">
        <table class="table table-reg table-reg-display table-responsive">
            <tbody>
                <tr>
                    <th style="background-color: #D6EEEE">Medallion Number: </th>
                    <td>{{ reg['medallion'] }}</td>
                </tr>
                <tr>
                    <th style="background-color: #D6EEEE">Check-In Date: </th>
                    {% if reg['checkin'] %}
                    <td>{{ reg['checkin'].strftime('%m/%d/%Y %I:%M %p') }}</td>
                    {% else %}
                    <td>{{reg['checkin']}}</td>
                    {% endif %}
                </tr>
                <tr>
                    <th style="background-color: #D6EEEE">Waiver Signature: </th>
                    {% if reg['signature'] %}
                    <td><img src="{{ reg['signature'] }}" style="height: 15a0px; width:300px"> </td>
                    {% else %}
                    <td></td>
                    {% endif %}
                </tr>
                <tr>
                    <th style="background-color: #D6EEEE">Emergency Contact: </th>
                    <td>{{ reg.emergency_contact_name }} <br>
                        Phone: {{ reg.emergency_contact_phone }} </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<h5>Cost</h5>
    <div class="row">
        <div class="col">
            <table class="table table-reg table-reg-display table-responsive">
                <tr>
                    <th>Registration</th>
                    <th>NMR</th>
                    <th>PayPal Donation</th>
                    <th>Total Price</th>
                    <th>Balance</th>
                </tr>
                <tr>
                    <td>{{ reg['registration_price'] }}</td>
                    <td>{{ reg['nmr_price'] }}</td>
                    <td>{{ reg['paypal_donation'] }}</td>
                    <td>{{ reg['total_due']}}</td>
                    <td>{{ reg['balance']}}</td>
                </tr>
            </table>   
        </div>
        <div class="col">
            <h5>Notes:</h5>
            {{ reg['notes'] }}
        </div>
    </div>

    <h5 class="no-print">Payments</h5>
    <div class="row no-print">
        <div class="col">
            <table class="table table-reg table-reg-display table-responsive">
                <tr>
                    <th>Payment Type</th>
                    <th>Amount</th>
                </tr>
            
                {% if reg.payments %}
                {% for payment in reg.payments %}
                <tr>
                    <td>{{ payment.type }}</td>
                    <td>{{ payment.amount }}</td>
                </tr>
                {% endfor %}
                {% endif %}
            </table>   
        </div>
    </div>

    <br>
    {% if atd_payments %}
    {% for pay in atd_payments %}
    {% if reg.invoice == None %}
    <h1 class="text-center" style="background-color: red; color: white;">{{pay.type}} - ${{pay.amount}}</h1>
        {% if reg['age'] == '18+' %}
        <h1 class="text-center m-0" style="background-color: red; color: white;">ADULT</h1> 
        {% if reg['mbr'] == false %}
        <h1 class="text-center m-0" style="background-color: red; color: white;">NON-MEMBER </h1>
        {% endif %}
        {% endif %}
        {% if reg['paypal_donation'] > 0 %}
        <h1 class="text-center m-0" style="background-color: red; color: white;">PAYPAL DONATION</h1>
        {% endif %}
    {% else %}
    <h1 class="text-center" style="background-color: red; color: white;">{{pay.type}} - ${{pay.amount}}</h1>
        {% if reg['age'] == '18+' %}
        <h1 class="text-center m-0" style="background-color: red; color: white;">OTHER: ${{pay.amount}}</h1> 
        {% endif %}
    {% endif %}
    {% endfor %}
    {% endif %}
    
   

    {% if not reg['signature'] %}

        <form method="post">
            <div class="row form-group no-print">
                <div class="col form-group">
                    <p>
                        <a href="/waiver">
                            <button type="submit" name="action" value="waiver" class="form-control btn btn-success btn-lg custom-input-space">Waivers</button>
                        </a>
                    </p>
                </div>
            </div>
        </form>
    {% endif %}

    {% if (not reg['checkin']) and (reg['signature']) %}

        <form method="post">
            <div class="row form-group no-print">
                <div class="col form-group">
                    <p>
                        <a href="/checkin">
                            <button type="submit" name="action" value="checkin" class="form-control btn btn-success btn-lg custom-input-space">Check-In</button>
                        </a>
                    </p>
                </div>
            </div>
        </form>
    {% endif %}

    {% if reg['balance'] > 0 and reg['checkin'] and reg['signature'] %}

    <form method="post">
        <div class="row form-group no-print">
            <div class="col form-group">
                <p>
                    <a href="/payment">
                        <button type="submit" name="action" value="payment" class="form-control btn btn-success btn-lg custom-input-space">Payment</button>
                    </a>
                </p>
            </div>
        </div>
    </form>
{% endif %}
    
    {% if reg['checkin'] %}
    {% if atd_payment %}
        <div class="row form-group no-print">
            <div class="col form-group">
                <button value='Print' type='button' class="btn btn-primary btn-lg form-control custom-input-space" onclick='handlePrint()'>Print</button>        
            </div>
        </div>
        <script type="text/javascript">
        const handlePrint = () => {
            var actContents = document.body.innerHTML;
            document.body.innerHTML = actContents;
            window.print();
            window.print();
        }
        </script>
    {% endif %}
        <div class="row form-group no-print">
            <div class="col form-group">
                <a href="/" class="btn btn-success btn-lg form-control custom-input-space" role="button">Done</a>         
            </div>
        </div>
    {%endif%}
    {% if current_user.has_role('Admin') or current_user.has_role('Department Head') or current_user.has_role('Troll Shift Lead')%}
    <form method="post">
        <div class="row form-group no-print">
            <div class="col form-group">
                <p>
                    <a href="/">
                        <button type="submit" name="action" value="Edit" class="form-control btn btn-warning btn-lg custom-input-space">Edit</button>
                    </a>              
                </p>
            </div>
        </div>
    </form>
    {% endif %}
        <!-- <br>
        <form method="post">
        <a href="/editreg">
            <button type="submit" name="action" value="editreg" class="btn btn-primary">Edit</button>
        </a>
        </form> -->
    
   
   
{% endblock %}